name: ci-check-pr
on:
  workflow_dispatch:
  workflow_call:
  pull_request:
    branches:
      - master
    types: [ opened, synchronize, reopened ]

jobs:
  ci-check-common:
    name: ci-check-common
    uses: ./.github/workflows/ci-check-common.yml

  ci-check-rust:
    name: ci-check-rust
    uses: ./.github/workflows/ci-check-rust.yml

  finalize-pr:
    runs-on: ubuntu-latest
    needs:
      - ci-check-common
      - ci-check-rust
    if: always()
    steps:
      - name: Everything is fine
        if: ${{ !(contains(needs.*.result, 'failure')) }}
        run: exit 0

      - name: Some tests failed
        if: ${{ contains(needs.*.result, 'failure') }}
        run: exit 1
